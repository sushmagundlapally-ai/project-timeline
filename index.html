<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project Timeline - Workstream Tracker</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <h1>üìä Project Timeline</h1>
                <p class="subtitle">Workstream & Task Tracker</p>
            </div>
            <div class="health-score-panel" id="healthScorePanel">
                <div class="health-score-circle" id="healthScoreCircle">
                    <span class="health-score-value" id="healthScoreValue">--</span>
                </div>
                <div class="health-score-info">
                    <span class="health-score-label">Program Health</span>
                    <span class="health-score-status" id="healthScoreStatus">Loading...</span>
                </div>
            </div>
            <div class="header-actions">
                <div class="program-selector">
                    <select id="programSelect" title="Select Program">
                        <option value="">-- Select Program --</option>
                    </select>
                    <button class="btn-icon-small" id="newProgramBtn" title="Create New Program">‚ûï</button>
                    <button class="btn-icon-small" id="deleteProgramBtn" title="Delete Current Program">üóëÔ∏è</button>
                </div>
                <div class="calendar-range">
                    <label>üìÖ</label>
                    <input type="month" id="startMonth" title="Start Month">
                    <span>to</span>
                    <input type="month" id="endMonth" title="End Month">
                </div>
                <button class="btn-icon" id="addWorkstreamBtn" title="Add Workstream">‚ûï</button>
                <button class="btn-icon" id="execSummaryBtn" title="Generate Executive Summary">üìù</button>
                <button class="btn-icon" id="exportCSVBtn" title="Export to Google Sheets (CSV)">üìä</button>
                <button class="btn-icon" id="importGoogleBtn" title="Import from Google Sheets">
                    <img src="https://www.gstatic.com/images/branding/product/1x/sheets_2020q4_48dp.png" alt="Sheets" style="width: 20px; height: 20px;">
                </button>
                <button class="btn-icon" id="importBtn" title="Import Local File">üì§</button>
                <input type="file" id="importFile" accept=".json,.csv" style="display: none;">
            </div>
        </header>

        <!-- Legend -->
        <div class="legend">
            <div class="legend-item">
                <span class="legend-color p0"></span>
                <span>P0 - Critical</span>
            </div>
            <div class="legend-item">
                <span class="legend-color p1"></span>
                <span>P1 - High</span>
            </div>
            <div class="legend-item">
                <span class="legend-color p2"></span>
                <span>P2 - Medium</span>
            </div>
            <div class="legend-item">
                <span class="legend-size">S</span>
                <span>Small</span>
            </div>
            <div class="legend-item">
                <span class="legend-size">M</span>
                <span>Medium</span>
            </div>
            <div class="legend-item">
                <span class="legend-size">L</span>
                <span>Large</span>
            </div>
        </div>

        <!-- Timeline Container -->
        <div class="timeline-wrapper">
            <div class="timeline-container" id="timelineContainer">
                <!-- Timeline Header with Months -->
                <div class="timeline-header" id="timelineHeader">
                    <div class="workstream-label-header">WORKSTREAM / TASK</div>
                    <div class="months-header" id="monthsHeader">
                        <!-- Months will be generated by JS -->
                    </div>
                </div>

                <!-- Timeline Body -->
                <div class="timeline-body" id="timelineBody">
                    <!-- Workstreams and tasks will be rendered here -->
                </div>
            </div>
        </div>

        <!-- Add/Edit Modal -->
        <div class="modal" id="taskModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 id="modalTitle">Add Task</h2>
                    <button class="modal-close" onclick="closeModal()">&times;</button>
                </div>
                <form id="taskForm">
                    <div class="form-group">
                        <label for="taskName">Task Name</label>
                        <input type="text" id="taskName" required placeholder="Enter task name">
                    </div>
                    <div class="form-group">
                        <label for="taskDescription">Description (optional)</label>
                        <textarea id="taskDescription" rows="2" placeholder="Enter task description..."></textarea>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="taskPriority">Priority</label>
                            <select id="taskPriority">
                                <option value="P0">P0 - Critical</option>
                                <option value="P1">P1 - High</option>
                                <option value="P2">P2 - Medium</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="taskSize">Size</label>
                            <select id="taskSize">
                                <option value="S">S - Small</option>
                                <option value="M">M - Medium</option>
                                <option value="L">L - Large</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="taskStart">Start Date</label>
                            <input type="date" id="taskStart" required>
                        </div>
                        <div class="form-group">
                            <label for="taskEnd">End Date</label>
                            <input type="date" id="taskEnd" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="taskStatus">Status</label>
                            <select id="taskStatus">
                                <option value="not-started">Not Started</option>
                                <option value="in-progress">In Progress</option>
                                <option value="blocked">Blocked</option>
                                <option value="at-risk">At Risk</option>
                                <option value="completed">Completed</option>
                                <option value="canceled">Canceled</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="taskOwner">Owner</label>
                            <input type="text" id="taskOwner" placeholder="Enter owner name">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="taskRisk">Risk Level</label>
                            <select id="taskRisk">
                                <option value="none">None</option>
                                <option value="low">‚óè Low</option>
                                <option value="medium">‚óÜ Medium</option>
                                <option value="high">‚ö†Ô∏è High</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group" id="riskTextGroup" style="display: none;">
                        <label for="taskRiskText">Risk Description</label>
                        <textarea id="taskRiskText" rows="2" placeholder="Describe the risk..."></textarea>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn-cancel" onclick="closeModal()">Cancel</button>
                        <button type="submit" class="btn-save">Save</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Add Workstream Modal -->
        <div class="modal" id="workstreamModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>Add Workstream</h2>
                    <button class="modal-close" onclick="closeWorkstreamModal()">&times;</button>
                </div>
                <form id="workstreamForm">
                    <div class="form-group">
                        <label for="workstreamName">Workstream Name</label>
                        <input type="text" id="workstreamName" required placeholder="Enter workstream name">
                    </div>
                    <div class="form-group">
                        <label for="workstreamOwner">Owner</label>
                        <input type="text" id="workstreamOwner" placeholder="Enter owner name">
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn-cancel" onclick="closeWorkstreamModal()">Cancel</button>
                        <button type="submit" class="btn-save">Add Workstream</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Google Sheets Import Modal -->
        <div class="modal" id="googleSheetsModal">
            <div class="modal-content" style="max-width: 550px;">
                <div class="modal-header">
                    <h2>üìä Import from Google Sheets</h2>
                    <button class="modal-close" onclick="closeGoogleModal()">&times;</button>
                </div>
                <div class="google-import-content">
                    <div class="import-tabs">
                        <button class="import-tab active" onclick="switchImportTab('url')">üîó Sheet URL</button>
                        <button class="import-tab" onclick="switchImportTab('paste')">üìã Paste Data</button>
                    </div>
                    
                    <div id="urlTab" class="import-tab-content active">
                        <div class="import-instructions">
                            <p><strong>How to get your Sheet URL:</strong></p>
                            <ol>
                                <li>Open your Google Sheet</li>
                                <li>Go to <strong>File ‚Üí Share ‚Üí Publish to web</strong></li>
                                <li>Select <strong>Comma-separated values (.csv)</strong></li>
                                <li>Click <strong>Publish</strong> and copy the URL</li>
                            </ol>
                        </div>
                        <div class="form-group">
                            <label for="googleSheetUrl">Published CSV URL</label>
                            <input type="url" id="googleSheetUrl" placeholder="https://docs.google.com/spreadsheets/d/.../pub?output=csv">
                        </div>
                        <button class="btn-save" onclick="importFromGoogleUrl()" style="width: 100%;">
                            Import from URL
                        </button>
                    </div>
                    
                    <div id="pasteTab" class="import-tab-content">
                        <div class="import-instructions">
                            <p><strong>Paste your data:</strong></p>
                            <p>Copy rows from Google Sheets and paste below. Format:</p>
                            <code>Workstream, Task, Owner, Priority, Size, Start, End, Risk</code>
                        </div>
                        <div class="form-group">
                            <label for="pasteData">Paste Data (CSV or Tab-separated)</label>
                            <textarea id="pasteData" rows="8" placeholder="Paste your data here..."></textarea>
                        </div>
                        <button class="btn-save" onclick="importFromPaste()" style="width: 100%;">
                            Import Pasted Data
                        </button>
                    </div>
                    
                    <div class="import-template">
                        <p>üì• <a href="#" onclick="downloadTemplate(); return false;">Download template</a> for the correct format</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bulk Upload Modal -->
    <div class="modal" id="bulkUploadModal">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h2>üìã Bulk Upload Tasks</h2>
                <button class="modal-close" onclick="closeBulkUploadModal()">&times;</button>
            </div>
            <div class="bulk-upload-content">
                <div class="import-instructions">
                    <p><strong>Paste your tasks below:</strong></p>
                    <p>Format (tab, comma, or pipe separated):</p>
                    <code>Task Name, Owner, Priority (P0/P1/P2), Size (S/M/L), Start Date, End Date, Risk, Description</code>
                    <p style="margin-top: 8px; color: var(--text-muted); font-size: 12px;">
                        üí° Tip: Copy directly from Google Sheets or Excel. Only Task Name is required.
                    </p>
                </div>
                <div class="form-group">
                    <label for="bulkTasksData">Tasks Data</label>
                    <textarea id="bulkTasksData" rows="10" placeholder="Email engine improvements, John, P0, L, 2025-01-01, 2025-03-31, high, Critical for Q1
Athena Auth spike, Sarah, P0, S, 2025-01-15, 2025-02-01, medium
Falcon Dev Ready, Mike, P0, L, 2025-02-01, 2025-04-30"></textarea>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn-cancel" onclick="closeBulkUploadModal()">Cancel</button>
                    <button type="button" class="btn-save" onclick="processBulkUpload()">üì• Import Tasks</button>
                </div>
            </div>
        </div>
    </div>

    <!-- View Task Details Modal -->
    <div class="modal" id="viewTaskModal">
        <div class="modal-content" style="max-width: 550px;">
            <div class="modal-header">
                <h2>üìÑ Task Details</h2>
                <button class="modal-close" onclick="closeViewTaskModal()">&times;</button>
            </div>
            <div class="view-task-content">
                <h3 class="view-task-title" id="viewTaskTitle">Task Name</h3>
                
                <div class="view-task-section">
                    <label>üìù Description</label>
                    <div class="view-task-value description" id="viewTaskDescription">No description added.</div>
                </div>
                
                <div class="view-task-grid">
                    <div class="view-task-item">
                        <label>üë§ Owner</label>
                        <span id="viewTaskOwner">Unassigned</span>
                    </div>
                    <div class="view-task-item">
                        <label>üéØ Priority</label>
                        <span id="viewTaskPriority">P1</span>
                    </div>
                    <div class="view-task-item">
                        <label>üìè Size</label>
                        <span id="viewTaskSize">M</span>
                    </div>
                    <div class="view-task-item">
                        <label>üìä Status</label>
                        <span id="viewTaskStatus">Not Started</span>
                    </div>
                </div>
                
                <div class="view-task-section">
                    <label>üìÖ Timeline</label>
                    <div class="view-task-value" id="viewTaskDates">Start ‚Üí End</div>
                </div>
                
                <div class="view-task-section" id="viewRiskSection">
                    <label>‚ö†Ô∏è Risk</label>
                    <div class="view-task-value risk" id="viewTaskRisk">None</div>
                    <div class="view-task-value risk-text" id="viewTaskRiskText">No risk details.</div>
                </div>
                
                <div class="view-task-section">
                    <label>üí¨ Comments</label>
                    <div class="view-task-comments" id="viewTaskComments">
                        <div class="no-comments">No comments yet.</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Executive Summary Modal -->
    <div class="modal" id="execSummaryModal">
        <div class="modal-content" style="max-width: 700px; max-height: 85vh;">
            <div class="modal-header">
                <h2>üìù Executive Summary</h2>
                <button class="modal-close" onclick="closeExecSummary()">&times;</button>
            </div>
            <div class="exec-summary-content">
                <div class="exec-summary-header">
                    <div class="exec-date" id="execDate"></div>
                    <div class="exec-program" id="execProgram"></div>
                </div>
                <div class="exec-summary-body">
                    <textarea id="execSummaryText" readonly></textarea>
                </div>
                <div class="exec-summary-actions">
                    <button class="btn-copy" onclick="copyExecSummary()">üìã Copy to Clipboard</button>
                    <button class="btn-edit" onclick="editExecSummary()">‚úèÔ∏è Edit Summary</button>
                    <button class="btn-save" onclick="closeExecSummary()">Done</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast -->
    <div class="toast" id="toast"></div>

    <script src="script.js"></script>
</body>
</html>

